<div class="character-build">
  <div>
    <% @starting_words.each do |word| %>
      <div class="row">
        <div class="col-md-12">
          <a class="btn word-selection" href="#"><%= word.capitalize %></a>
        </div>
      </div>
    <% end %>
  </div>

  <div class="character-sheet">
    <div class="character-sheet-head">
      <%= image_tag "top_edge.png", class:"paper"%>
    </div>
    <div class="character-sheet-body">
      <div class="stats">
        <p>yo</p>
      </div>
      <div class="story">
        <%= form_tag({controller: "characters", actions: "create"}, method: "post") do %>
          <div>
            <%= text_area_tag 'story', "", size: "50x15" %>
            <%= submit_tag "SAVE STORY", class: "btn" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  const storyary = []
  const story = document.getElementById("story")
  const wordbuttons = document.querySelectorAll("a.word-selection");
  wordbuttons.forEach(function(wordbutton) {
    wordbutton.addEventListener("click", (event) => {
      var word = event.srcElement.innerText;
      fetch(`<%= generate_story_path %>?word=${word}`, {
        credentials: "same-origin"
      })
      .then(response => {
        return response.json();
      })
      .then((data) => {
        // grab array of new words
        data.suggestions.forEach(function(suggestion, index) {
          wordbuttons[index].innerText = suggestion
        });
        // replace all existing word buttons with new words
        storyary.push(data.word)
        story.value = storyary.join(' ')
        });
      });
    });
</script>
